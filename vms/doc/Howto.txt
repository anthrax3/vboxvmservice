##############################################################################
#
#   PART I - SETUP
#
##############################################################################

Step 1. Download and unzip the latest release of VBoxVmService to c:\vms.

Step 2. Open up VBoxVmService.ini with a texteditor of your choice and modify it to fit your needs. The file contains an example setup with two virtual machines.

Key / Value pair                                            Description
-----------------------------------------------------------------------------
[Settings]
ServiceName=VBoxVmService                                   The service name to use for the VBoxVmService.
VBOX_USER_HOME=C:\Users\YOUR_NAME_HERE\.VirtualBox          The actual path to your user's .VirtualBox directory. It is usually located in your users' personal folder.
[Vm0]
VmName=ubuntu                                               The name of the VM to start (case sensitive!)
CommandLineUp=c:\vms\startup.exe 0 BRUTEFORCE               The startup command (please note: the BRUTEFORCE parameter is optional).
CommandLineDown=c:\vms\shutdown.exe 0                       The shutdown command
WorkingDir=C:\vms                                           Usually the directory to which you unpacked VBoxVmService.
StartupMethod=vrdp                                          VRDP is the only headless option that is reported to work at the moment.
ShutdownMethod=savestate                                    The shutdown method ("savestate", or "poweroff")
VrdpPort=3001                                               The port setting for your VRDP-Access, choose 1 unique port per VM that you set up.
PauseShutdown=15000                                         A pause parameter to slow down the Windows shutdown process and to prevent VMs from crashing on shutdown/reboot. (15000 = 15 seconds)
[Vm1]
VmName=winxp                                                As you can see, the above values almost repeat for every [VmX] section of the file, 
CommandLineUp=c:\vms\startup.exe 1                          where X is an ascending number.
CommandLineDown=c:\vms\shutdown.exe 1
WorkingDir=C:\vms
StartupMethod=vrdp
ShutdownMethod=poweroff
VrdpPort=3002                                               
PauseShutdown=15000 



##############################################################################
#
#   PART II - INSTALLATION
#
##############################################################################

Step 1. (for WINXP / SERVER2003) Launch CMD (Command Prompt) from your start menu.

Step 1. (for VISTA / SERVER2008 / WIN7) Right-click on CMD (Command Prompt) and choose "Run as Administrator" from the context menu.

Step 2. Within the terminal window type:
    
    cd C:\vms               [ENTER]
    
    VBoxVmService.exe -i    [ENTER]

Step 3. Reboot your system!

Step 4. You are done installing and ready to use VBoxVmService.



##############################################################################
#
#   PART III - UNINSTALL
#
##############################################################################

Step 1. Stop the VBoxVmService service.

Step 2. (for WINXP / SERVER2003) Launch CMD (Command Prompt) from your start menu.

Step 2. (for VISTA / SERVER2008 / WIN7) Right-click on CMD (Command Prompt) and choose "Run as Administrator" from the context menu.

Step 3. Within the terminal window type:
    
    cd C:\vms               [ENTER]
    
    VBoxVmService.exe -u    [ENTER]
    
Step 4. Delete the installation directory (in this example "c:\vms").

Step 5. You are done uninstalling VBoxVmService from your system.

##############################################################################
#
#   PART IV - TROUBLESHOOTING
#
##############################################################################

If the service does not bring your VMs up as desired, try this:

Check whether there is any data in the folders "lock", "tmp" or "run" and delete it.

If you are experiencing this issue frequently, add the option "BRUTEFORCE" (without quotes) to the call to "startup.exe" within the .INI-File (e.g.: startup.exe 0 BRUTEFORCE"). 

THE "BRUTEFORCE"-OPTION MUST BE GIVEN IN CAPS! 

This will delete any possibly existing run- or lockfiles for the VM before startup.

Carefully re-check the settings you made in "VBoxVmService.ini". 

Reduce the number of VMs in your ini file to one (= only have the section [Settings] and the section [Vm0] in your ini-file) in your ini-file, for debugging.

Switch to a command prompt, cd to the VBoxVmService directory and type:

    startup.exe 0   [ENTER]

to bring up the VM you set up in the section [Vm0] of the "VBoxVmService.ini" file.

Hint:

If you have successfully started a VM, you should end up with a "VBoxVRDP.exe" process, running as the impersonated user (check in task manager) plus a lockfile in the "run" folder. This lockfile should be carrying the Id of the started VM as a file extension (for example: "2002021812114503.vm0" for a running instance of the "Virtual Machine 0" set up by the section [Vm0] of the "VBoxVmServie.ini" file)


IMPORTANT: If you want to control your VMs with VRDP, assign a dedicated port for each individual VM. Do NOT use the standard port 3389 (e.g. use: 3010 for Vm0, 3020 for Vm1, etc.)!

The command:

    shutdown.exe 0  [ENTER]

can be used to check the output, generated by the steps of a shutdown process targeting [Vm0].  Afterwards there should be no lockfile in the "run" folder with a ".vm0" extension and no running "VBoxVRDP.exe"-process. Additionally, you should see a "VBoxSVC.exe"-process terminating shortly after a successful shutdown of "VBoxVRDP.exe".

If you manage to bring your Virtual Machine up and down from the command prompt, you should be experiencing no further problems.

Read the log-file! 

Note: 

Some errors are quite casual and result from the "multi-service" and "multi-tool" method used.  Common errors are "Service Control" errors, which result from the fact that starting a VM means starting a whole bunch of tools and scripts and finally ending up with a distributed software-system, that is probably running as another user, so don't mind these.

I might be on VirtualBox's official forums now and then, so feel free to contact me there.


